{% extends "layout.html" %}
{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8 text-center">
        <div class="card shadow-sm p-4 mb-4">
            <h3 class="fw-bold text-dark">Welcome, {{ current_user.username }}!</h3>
            <p class="text-muted">Copy your link and share it on Instagram/Snapchat</p>
            <div class="input-group mb-3">
                <input type="text" id="myLink" class="form-control text-center bg-light" value="{{ url_for('send_message', username=current_user.username, _external=True) }}" readonly>
                <button class="btn btn-primary px-4" onclick="copyLink()">Copy Link</button>
            </div>
            <div class="d-inline-block badge bg-primary p-2 px-4 fs-6 rounded-pill shadow-sm">Inbox: {{ count }} Messages</div>
        </div>

        <h5 class="text-start mb-3 fw-bold">My Messages</h5>
        <div class="row">
            {% for msg in messages %}
            <div class="col-12 mb-3">
                <div class="card shadow-sm p-3 text-start position-relative border-0" style="background: #ffffff;">
                    <p class="mb-2 text-dark fs-5">{{ msg.content }}</p>
                    
                    <div class="d-flex align-items-center justify-content-between mt-2">
                        <small class="text-muted" style="font-size: 0.7rem;">
                            <i class="bi bi-clock"></i> {{ format_date(msg.timestamp) }}
                        </small>

                        <div class="premium-info">
                            {% if current_user.is_premium %}
                                <span class="badge bg-light text-primary border" style="font-size: 0.65rem;">
                                    <i class="bi bi-phone"></i> {{ msg.device_info or 'Unknown' }}
                                </span>
                            {% else %}
                                <span class="text-muted" style="font-size: 0.65rem; cursor: pointer;" title="Upgrade to see device info">
                                    <i class="bi bi-lock-fill"></i> <span class="d-none d-sm-inline">Device info locked</span>
                                </span>
                            {% endif %}
                        </div>
                    </div>

                    <form action="{{ url_for('delete_message', msg_id=msg.id) }}" method="POST" class="position-absolute top-0 end-0 m-2">
                        <button type="submit" class="btn btn-link text-danger p-1" onclick="return confirm('Delete this message?')">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="red" viewBox="0 0 16 16">
                                <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"/>
                                <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"/>
                            </svg>
                        </button>
                    </form>
                </div>
            </div>
            {% else %}
            <div class="text-center py-5">
                <p class="text-muted">Your inbox is empty. Share your link to get messages!</p>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<script>
function copyLink() {
  var copyText = document.getElementById("myLink");
  copyText.select();
  document.execCommand("copy");
  alert("Link copied! Now paste it in your bio.");
}
</script>
{% endblock %}
